var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,a){function s(t){try{h(r.next(t))}catch(e){a(e)}}function n(t){try{h(r["throw"](t))}catch(e){a(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,n)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,a&&(s=a[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(a,i[1])).done)return s;switch(a=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,a=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],a=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,a,s,n,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n},Game=function(t){function e(){var e=t.call(this)||this;return e.bodyNumber=3,e.points=new Array,e.factor=50,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.leftBound=.25*this.stage.stageWidth,this.rightBound=.75*this.stage.stageWidth,this.topBound=.15*this.stage.stageHeight,this.createGameScene(this),[2]})})},e.prototype.keepTrack=function(){var t=50*this.bodyCircle.position[0],e=this.stage.stageHeight-50*this.bodyCircle.position[1];t<this.leftBound&&(this.bodyCircle.position[0]=this.leftBound/50),t>this.rightBound&&(this.bodyCircle.position[0]=this.rightBound/50),e<this.topBound&&(this.bodyCircle.position[1]=(this.stage.stageHeight-this.topBound)/50)},e.prototype.onTouchMove=function(t){},e.prototype.onTouchBegin=function(t){this.startTouchX=t.stageX,this.startTouchY=t.stageY},e.prototype.onTouchTap=function(t){this.bodyCircle.velocity[1]=10},e.prototype.createDebug=function(){var t=new egret.Sprite;this.addChild(t),this.debugDraw=new p2DebugDraw(this.world,t,this.stage.stageHeight)},e.prototype.touchEventHandler=function(t){var e=new Array(t.stageX/this.factor,t.stageY/this.factor);switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this.prePoint=this.copyPoint(e),this.points.push(this.prePoint,this.prePoint),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchEventHandler,this);break;case egret.TouchEvent.TOUCH_END:this.createConvexBody(),this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchEventHandler,this);break;case egret.TouchEvent.TOUCH_MOVE:var i=p2.vec2.dist(e,this.prePoint);i>30/this.factor?(this.points.push(this.prePoint),this.prePoint=this.copyPoint(e),this.points[this.points.length-1]=this.copyPoint(e)):this.points[this.points.length-1]=this.copyPoint(e)}},e.prototype.createConvexBody=function(){for(var t=new p2.Body({mass:1}),e=0;e<this.points.length;++e)this.points[e][1]=(this.stage.stageHeight-this.points[e][1]*this.factor)/this.factor;t.fromPolygon(this.points,{optimalDecomp:!1}),this.world.addBody(t),this.points=[]},e.prototype.copyPoint=function(t){return new Array(t[0],t[1])},e.prototype.createGameScene=function(e){this.touchEnabled=!0,this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchEventHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEventHandler,this);var i=new p2.World;this.world=i;var r=new egret.Shape;r.graphics.beginFill(8912258),r.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),r.graphics.endFill(),t.prototype.addChild.call(this,r),i.sleepMode=p2.World.NO_SLEEPING;var o=new egret.Bitmap(RES.getRes("ball_png"));this.addChild(o),i.gravity=[0,-10],this.bodyCircle=new p2.Body({mass:1,position:[this.stage.stageWidth/2/50,(this.stage.stageHeight+200)/50]});var a=new p2.Circle({radius:1});this.bodyCircle.addShape(a),i.addBody(this.bodyCircle),o.width=50*a.radius*2,o.height=50*a.radius*2,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,this.bodyCircle.displays=[o];var s=new egret.Bitmap(RES.getRes("square_png")),n=new p2.Body({position:[0,0]}),h=new p2.Convex({vertices:new Array([0/this.factor,200/this.factor],[0,0],[400/this.factor,0],[400/this.factor,200/this.factor])});n.addShape(h),i.addBody(n);var c=new p2.Body({position:[0,-2]}),d=new p2.Plane;c.addShape(d),i.addBody(c);var p=new egret.Sprite;p.graphics.lineStyle(1,16777215),p.graphics.beginFill(16777215,1),p.graphics.moveTo(0,this.stage.stageHeight-200),p.graphics.lineTo(0,this.stage.stageHeight-0),p.graphics.lineTo(400,this.stage.stageHeight-0),p.graphics.lineTo(400,this.stage.stageHeight-200),p.graphics.lineTo(0,this.stage.stageHeight-200),p.graphics.endFill(),s.scaleX=5,s.scaleY=2,s.anchorOffsetX=s.width/2,s.x=this.stage.stageWidth/2,s.y=this.stage.stageHeight-200,this.addChild(p),this.createDebug(),egret.Ticker.getInstance().register(function(t){i.step(t/1e3),this.points.length>1&&this.debugDraw.drawLineConvex(this.points,16777215,.5,!0),o.x=50*this.bodyCircle.position[0],o.y=this.stage.stageHeight-50*this.bodyCircle.position[1],o.rotation=360-180*this.bodyCircle.angle/Math.PI,this.bodyCircle.position[1]<-1,this.debugDraw.drawDebug(this.bodyNumber),this.keepTrack()},this);var l=new egret.TextField;l.text="Let it Move!",l.size=100,this.addChild(l),l.fontFamily="Segoe UI Light",l.anchorOffsetX=l.textWidth/2,l.anchorOffsetY=l.textHeight/2,l.x=this.stage.stageWidth/2,l.y=this.stage.stageHeight/2-300},e.prototype.touchHandler=function(t){},e}(egret.DisplayObjectContainer);__reflect(Game.prototype,"Game");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH,[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var e=new egret.Shape;e.graphics.beginFill(8912258),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),t.prototype.addChild.call(this,e);var i=new egret.TextField;i.text="Bounce!",i.size=100,this.addChild(i),i.fontFamily="Segoe UI Light",i.anchorOffsetX=i.textWidth/2,i.anchorOffsetY=i.textHeight/2,i.x=this.stage.stageWidth/2,i.y=this.stage.stageHeight/2-300;var r=new egret.Bitmap(RES.getRes("ball_png"));r.anchorOffsetX=r.width/2,r.anchorOffsetY=r.height/2,r.x=this.stage.stageWidth/2,r.y=this.stage.stageHeight/2,this.addChild(r),egret.Tween.get(r,{loop:!0}).to({scaleX:.5,scaleY:.5},2e3,egret.Ease.backInOut);var o=new egret.Bitmap(RES.getRes("button_png"));o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o.x=this.stage.stageWidth/2,o.y=this.stage.stageHeight/2+300,o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this),this.addChild(o)},e.prototype.touchHandler=function(t){this.stage.addChild(new Game)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var p2DebugDraw=function(){function t(t,e,i){this.COLOR_D_SLEEP=16777215,this.COLOR_D_WAKE=16777215,this.COLOR_K=16777215,this.COLOR_S=16777215,this.COLOR_BLACK=16777215,this.COLOR_RED=16777215,this.isDrawAABB=!1,this.factor=50,this.world=t,this.sprite=e,this.STAGEHEIGHT=i}return t.prototype.drawDebug=function(t){this.sprite.graphics.clear();for(var e=this.world.bodies.length-t,i=t;t+e>i;i++){var r=this.world.bodies[i];if(!(r.position[1]<-2))for(var o=0;o<r.shapes.length;o++){var a=r.shapes[o];this.drawShape(a,r),this.isDrawAABB&&this.drawAABB(r)}}e=this.world.constraints.length;for(var s,o=0;e>o;o++)switch(s=this.world.constraints[o],s.type){case p2.Constraint.DISTANCE:this.drawDistanceJoint(s);break;case p2.Constraint.REVOLUTE:this.drawRevoluteJoint(s);break;case p2.Constraint.GEAR:this.drawGearJoint(s);break;case p2.Constraint.PRISMATIC:this.drawPrismaticJoint(s);break;case p2.Constraint.LOCK:this.drawLockJoint(s)}e=this.world.springs.length;for(var n,h=0;e>h;h++)n=this.world.springs[h],n instanceof p2.LinearSpring?this.drawLinearSpring(n):n instanceof p2.RotationalSpring&&this.drawRotationalSpring(n)},t.prototype.drawAABB=function(t){var e=new Array,i=t.aabb.lowerBound[0],r=t.aabb.lowerBound[1],o=t.aabb.upperBound[0],a=t.aabb.upperBound[1];isFinite(i)&&isFinite(r)&&isFinite(o)&&isFinite(a)&&(e.push([i,r],[o,r],[o,a],[i,a]),this.drawConvex(e,this.COLOR_S,1,!1))},t.prototype.drawDistanceJoint=function(t){var e,i=new Array,r=new Array;e=t.distance,t.upperLimitEnabled&&t.upperLimit>e&&(e=t.upperLimit),t.bodyA.toWorldFrame(i,t.localAnchorA),t.bodyB.toWorldFrame(r,t.localAnchorB);var o=p2.vec2.subtract([],r,i);p2.vec2.normalize(o,o),p2.vec2.scale(o,o,e);var a=p2.vec2.add([],i,o);this.drawSegment(i,t.bodyA.position,this.COLOR_S),this.drawSegment(r,t.bodyB.position,this.COLOR_S),this.drawVecAt(o,i,this.COLOR_BLACK),t.position>e&&this.drawSegment(r,a,this.COLOR_RED),this.drawCircle(i,3/this.factor,this.COLOR_BLACK),this.drawCircle(a,3/this.factor,this.COLOR_BLACK),t.lowerLimitEnabled&&(p2.vec2.normalize(o,o),p2.vec2.scale(o,o,t.lowerLimit),a=p2.vec2.add([],i,o),this.drawCircle(a,2/this.factor,this.COLOR_BLACK))},t.prototype.drawRevoluteJoint=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.pivotA),t.bodyB.toWorldFrame(i,t.pivotB),this.drawSegment(t.bodyA.position,e,this.COLOR_S),this.drawSegment(t.bodyB.position,i,this.COLOR_S),this.drawSegment(e,i,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK)},t.prototype.drawGearJoint=function(t){var e=t.bodyA.position,i=t.bodyB.position,r=new Array,o=new Array;t.bodyA.toWorldFrame(r,[20/this.factor,0]),t.bodyB.toWorldFrame(o,[20/this.factor,0]);var a=p2.vec2.subtract([],e,r),s=p2.vec2.subtract([],i,o);this.drawVecAt(a,e,this.COLOR_BLACK,!0),this.drawVecAt(s,i,this.COLOR_BLACK,!0),t.bodyB.toWorldFrame(s,[10*(t.bodyB.angle-t.bodyA.angle-t.angle)/this.factor,0]),this.drawSegment(s,i,this.COLOR_RED)},t.prototype.drawPrismaticJoint=function(t){var e=(t.bodyA.position,t.bodyB.position,new Array),i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=new Array;r=this.toWorldVector(t.localAxisA,t.bodyA);var o=p2.vec2.copy([],r),a=p2.vec2.copy([],r);t.lowerLimitEnabled?p2.vec2.scale(o,r,t.lowerLimit):p2.vec2.scale(o,r,5e3),t.upperLimitEnabled?p2.vec2.scale(a,r,t.upperLimit):p2.vec2.scale(a,r,5e3),this.drawVecAt(o,e,this.COLOR_BLACK,!0),this.drawVecAt(a,e,this.COLOR_BLACK,!0),p2.vec2.add(o,o,e),this.drawCircle(o,2/this.factor,this.COLOR_BLACK,1,!0),p2.vec2.add(a,a,e),this.drawCircle(a,2/this.factor,this.COLOR_BLACK,1,!0)},t.prototype.drawLockJoint=function(t){var e=new Array;new Array;t.bodyA.toWorldFrame(e,t.localOffsetB),this.drawSegment(e,t.bodyA.position,this.COLOR_S),this.drawSegment(e,t.bodyB.position,this.COLOR_RED),this.drawCircle(e,3/this.factor,this.COLOR_BLACK);var i=new Array;t.bodyA.toWorldFrame(i,[20/this.factor,0]),this.drawSegment(i,t.bodyA.position,this.COLOR_BLACK),t.bodyB.toWorldFrame(i,[20/this.factor,0]),this.drawSegment(i,t.bodyB.position,this.COLOR_BLACK)},t.prototype.drawLinearSpring=function(t){var e=new Array,i=new Array;t.bodyA.toWorldFrame(e,t.localAnchorA),t.bodyB.toWorldFrame(i,t.localAnchorB);var r=p2.vec2.subtract([],i,e);p2.vec2.normalize(r,r),p2.vec2.scale(r,r,t.restLength);var o=p2.vec2.add([],t.bodyA.position,r);this.drawSegment(o,t.bodyB.position,this.COLOR_RED),this.drawVecAt(r,e,this.COLOR_BLACK),this.drawCircle(e,3/this.factor,this.COLOR_RED),this.drawCircle(o,3/this.factor,this.COLOR_RED)},t.prototype.drawRotationalSpring=function(t){var e=new Array,i=new Array;e=t.bodyA.position,i=t.bodyB.position;var r=new Array,o=new Array;t.bodyA.toWorldFrame(r,[20/this.factor,0]),t.bodyB.toWorldFrame(o,[10*(t.bodyB.angle-t.bodyA.angle-t.restAngle+2)/this.factor,0]);var a=p2.vec2.subtract([],r,e),s=p2.vec2.subtract([],o,i);this.drawVecAt(a,e,this.COLOR_RED,!0),this.drawVecAt(s,i,this.COLOR_RED,!0),t.bodyB.toWorldFrame(o,[20/this.factor,0]),this.drawCircle(r,2/this.factor,this.COLOR_RED),this.drawCircle(o,2/this.factor,this.COLOR_RED)},t.prototype.drawShape=function(t,e,i,r){var i=void 0==i?this.getColor(e):i,r=void 0==r?!0:r;t instanceof p2.Convex?this.drawConvexShape(t,e,i,r):t instanceof p2.Plane?this.drawPlaneShape(t,e,i,r):t instanceof p2.Circle?this.drawCircleShape(t,e,i,r):t instanceof p2.Capsule?this.drawCapsule(t,e,i):t instanceof p2.Particle?this.drawParticle(t,e,i):t instanceof p2.Line?this.drawLine(t,e,i):t instanceof p2.Heightfield&&this.drawHeightfeild(t,e,i)},t.prototype.drawConvexShape=function(t,e,i,r){var o=(e.shapes.indexOf(t),t.position),a=t.angle,s=[],n=this.transformVec(t.vertices[0],o,a);e.toWorldFrame(s,o),e.toWorldFrame(n,n),this.drawSegment(s,n,i);for(var h=new Array,c=t.vertices.length,d=0;c>d;d++)n=this.transformVec(t.vertices[d],o,a),e.toWorldFrame(n,n),h.push(n);this.drawConvex(h,i,.9,r)},t.prototype.drawParticle=function(t,e,i){this.drawCircle(e.position,1/this.factor,i,.5),this.drawCircle(e.position,5/this.factor,i,1,!1)},t.prototype.drawLine=function(t,e,i){var r=t.length,o=new Array,a=new Array;e.toWorldFrame(o,[-r/2,0]),e.toWorldFrame(a,[r/2,0]),this.drawSegment(o,a,i)},t.prototype.drawHeightfeild=function(t,e,i){var r=this.sprite.graphics;r.lineStyle(1,i),r.beginFill(i,.5);var o,a=t.heights,s=t.elementWidth,n=new Array,h=new Array;a.forEach(function(t,i){o=i*s,n=new Array,e.toWorldFrame(n,[o,t]),h.push(n)}),n=new Array,e.toWorldFrame(n,[o,-500]),h.push(n),n=new Array,e.toWorldFrame(n,[0,-500]),h.push(n),n=new Array,e.toWorldFrame(n,[0,0]),h.push(n),this.drawConvex(h,i,.5)},t.prototype.drawCapsule=function(t,e,i){var r=t.length,o=t.radius,a=new Array,s=new Array,n=new Array,h=new Array,c=new Array,d=new Array;e.toWorldFrame(a,[-r/2,-o]),e.toWorldFrame(s,[r/2,-o]),e.toWorldFrame(n,[r/2,o]),e.toWorldFrame(h,[-r/2,o]),e.toWorldFrame(c,[r/2,0]),e.toWorldFrame(d,[-r/2,0]),this.drawCircle(c,o,i,.5),this.drawCircle(d,o,i,.5),this.drawConvex([a,s,n,h],i,.5)},t.prototype.drawCircleShape=function(t,e,i,r){var o=t.position,a=t.angle,s=new Array;e.toWorldFrame(s,o),this.drawCircle(s,t.radius,i,.5,r);var n=this.transformVec([t.radius,0],o,a);e.toWorldFrame(n,n),this.drawSegment(s,n,i)},t.prototype.drawPlaneShape=function(t,e,i,r){var o=new Array,a=new Array;e.shapes.indexOf(t);e.toWorldFrame(o,[1e3,0]),o=this.transformVec(o,t.position,t.angle),a.push(o),o=new Array,e.toWorldFrame(o,[1e3,-1e5]),o=this.transformVec(o,t.position,t.angle),a.push(o),o=new Array,e.toWorldFrame(o,[-1e3,-1e5]),o=this.transformVec(o,t.position,t.angle),a.push(o),o=new Array,e.toWorldFrame(o,[-1e3,0]),o=this.transformVec(o,t.position,t.angle),a.push(o),this.drawConvex(a,i,.5,r)},t.prototype.getColor=function(t){var e=this.COLOR_D_SLEEP;return t.type==p2.Body.KINEMATIC?e=this.COLOR_K:t.type==p2.Body.STATIC?e=this.COLOR_S:t.sleepState==p2.Body.AWAKE&&(e=this.COLOR_D_WAKE),e},t.prototype.drawVecAt=function(t,e,i,r){void 0===r&&(r=!1);var o=p2.vec2.copy([],e),a=p2.vec2.add([],t,e);r&&this.drawCircle(o,3/this.factor,i),this.drawSegment(o,a,i)},t.prototype.drawVecTo=function(t,e,i,r){void 0===r&&(r=!1);var o=p2.vec2.copy([],e),a=p2.vec2.subtract([],e,t);r&&this.drawCircle(o,3/this.factor,i),this.drawSegment(o,a,i)},t.prototype.drawSegment=function(t,e,i){this.sprite.graphics.lineStyle(1,i),this.sprite.graphics.moveTo(t[0]*this.factor,this.STAGEHEIGHT-t[1]*this.factor),this.sprite.graphics.lineTo(e[0]*this.factor,this.STAGEHEIGHT-e[1]*this.factor)},t.prototype.drawCircle=function(t,e,i,r,o){void 0===r&&(r=1),this.sprite.graphics.lineStyle(1,i),(o||void 0==o)&&this.sprite.graphics.beginFill(i,r),this.sprite.graphics.drawCircle(t[0]*this.factor,this.STAGEHEIGHT-t[1]*this.factor,e*this.factor),this.sprite.graphics.endFill()},t.prototype.drawLineConvex=function(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!0),this.sprite.graphics.lineStyle(1,e),r&&this.sprite.graphics.beginFill(e,i);var o=t.length,a=t[0];this.sprite.graphics.moveTo(a[0]*this.factor,a[1]*this.factor);for(var s=1;o>=s;s++)a=t[s%o],this.sprite.graphics.lineTo(a[0]*this.factor,a[1]*this.factor);this.sprite.graphics.endFill()},t.prototype.drawConvex=function(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!0),this.sprite.graphics.lineStyle(1,e),r&&this.sprite.graphics.beginFill(e,i);var o=t.length,a=t[0];this.sprite.graphics.moveTo(a[0]*this.factor,this.STAGEHEIGHT-a[1]*this.factor);for(var s=1;o>=s;s++)a=t[s%o],this.sprite.graphics.lineTo(a[0]*this.factor,this.STAGEHEIGHT-a[1]*this.factor);this.sprite.graphics.endFill()},t.prototype.toWorldVector=function(t,e){var i=new Array;return p2.vec2.rotate(i,t,e.angle),i},t.prototype.transformVec=function(t,e,i){var r=new Array;return p2.vec2.rotate(r,t,i),p2.vec2.add(r,r,e),r},t.prototype.drawDotLine=function(t,e,i,r){if(void 0===e&&(e=0),void 0===i&&(i=!1),void 0===r&&(r=30),!(t.length<2)){var o=2/this.factor,a=[];p2.vec2.copy(a,t[0]),this.drawCircle(a,o,e,1,!1);for(var s=0;s<t.length-2;s++){var n=t[s];if(i)for(var h=p2.vec2.distance(a,n);h>r/this.factor;){var c=[];p2.vec2.subtract(c,n,a),p2.vec2.scale(c,c,r/this.factor/h),p2.vec2.add(a,a,c),this.drawCircle(a,o,e,1,!1),h=p2.vec2.distance(a,n)}else this.drawCircle(n,o,e,1,!1)}}},t}();__reflect(p2DebugDraw.prototype,"p2DebugDraw");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);